
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learning material for APIfy your infra with Crossplane">
      
      
        <meta name="author" content="Álvaro Santos Andrés">
      
      
        <link rel="canonical" href="https://alvsanand.github.io/apify-your-infra-with-crossplane/implement-gitops/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Lab 3 - Implement GitOps - APIfy your infra with Crossplane</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-3-implement-gitops" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="APIfy your infra with Crossplane" class="md-header__button md-logo" aria-label="APIfy your infra with Crossplane" data-md-component="logo">
      
  <img src="../assets/images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APIfy your infra with Crossplane
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 3 - Implement GitOps
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/alvsanand/apify-your-infra-with-crossplane" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    alvsanand/apify-your-infra-with-crossplane
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../overview/" class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../setup/" class="md-tabs__link">
      Lab 1 - Setup
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../know-the-basis/" class="md-tabs__link">
      Lab 2 - Know the basis
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Lab 3 - Implement GitOps
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="APIfy your infra with Crossplane" class="md-nav__button md-logo" aria-label="APIfy your infra with Crossplane" data-md-component="logo">
      
  <img src="../assets/images/favicon.png" alt="logo">

    </a>
    APIfy your infra with Crossplane
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/alvsanand/apify-your-infra-with-crossplane" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    alvsanand/apify-your-infra-with-crossplane
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Lab 1 - Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../know-the-basis/" class="md-nav__link">
        Lab 2 - Know the basis
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Lab 3 - Implement GitOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Lab 3 - Implement GitOps
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-creating-iac-repository" class="md-nav__link">
    1. Creating IaC repository
  </a>
  
    <nav class="md-nav" aria-label="1. Creating IaC repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-create-a-github-repository" class="md-nav__link">
    1.1. Create a Github repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-add-crossplane-resources" class="md-nav__link">
    1.2. Add Crossplane resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-an-app-in-argocd" class="md-nav__link">
    2. Create an App in ArgoCD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-commit-changes-to-github" class="md-nav__link">
    3. Commit changes to Github
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-wait-for-argocd-to-sync" class="md-nav__link">
    4. Wait for ArgoCD to sync
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-cleanup-the-laboratory" class="md-nav__link">
    5. Cleanup the laboratory
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-creating-iac-repository" class="md-nav__link">
    1. Creating IaC repository
  </a>
  
    <nav class="md-nav" aria-label="1. Creating IaC repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-create-a-github-repository" class="md-nav__link">
    1.1. Create a Github repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-add-crossplane-resources" class="md-nav__link">
    1.2. Add Crossplane resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-an-app-in-argocd" class="md-nav__link">
    2. Create an App in ArgoCD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-commit-changes-to-github" class="md-nav__link">
    3. Commit changes to Github
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-wait-for-argocd-to-sync" class="md-nav__link">
    4. Wait for ArgoCD to sync
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-cleanup-the-laboratory" class="md-nav__link">
    5. Cleanup the laboratory
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="lab-3-implement-gitops">Lab 3 - Implement GitOps</h1>
<p><img alt="Crossplane and ArgoCD" src="../assets/images/crossplane-argo.png" /></p>
<p>GitOps is a set of practices to manage infrastructure and application configurations using Git, an open source version control system. GitOps works by using Git as a single source of truth for declarative infrastructure and applications. The Git repository contains the entire state of the system so that the trail of changes to the system state are visible and auditable.</p>
<p>Using GitOps tool such as Argo CD or Flux CD, we will be able to make our target system match the desired state that is coded in the Git repository. So when we will deploy new resources or update an existing ones, after updating the repository the automated process will apply the changes.</p>
<p>In the last laboratory, we will apply this concepts to deploy our infrastructure using Crossplane and <a href="https://argo-cd.readthedocs.io/en/stable/">Argo CD</a> without human intervention.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you want to know more about Gitops and Argo CD, please read my article <a href="https://santanderglobaltech.com/en/from-git-to-kubernetes-in-10-minutes-with-argocd/">From GIT to Kubernetes in 10 minutes with ArgoCD</a>.</p>
</div>
<h2 id="1-creating-iac-repository">1. Creating IaC repository</h2>
<p>As said before, a Git will be our source of truth for our infrastructure and will contain the entire state and history of it. So that the trail of changes to the system state are visible and auditable.</p>
<h3 id="11-create-a-github-repository">1.1. Create a Github repository</h3>
<p>First thing to do is to create a Git repository that we will use to store the Crosplanes files.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>gh repo create --public acw-crossplane-with-argocd --clone --gitignore Python

<span class="nb">cd</span> acw-crossplane-with-argocd
</code></pre></div>
</td></tr></table>
<h3 id="12-add-crossplane-resources">1.2. Add Crossplane resources</h3>
<p>Next, we have to add the yaml files containing the Crossplain resources. However, we will not push the changes to the repository.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In this case, we have to add <code>argocd.argoproj.io/sync-wave</code> and <code>argocd.argoproj.io/sync-options</code> annotations that will indicate ArgoCD the order of execution so claim must execute only after XD resources are created. See <a href="https://argo-cd.readthedocs.io/en/stable/user-guide/sync-waves/">Sync Phases and Waves</a> and <a href="https://argo-cd.readthedocs.io/en/stable/user-guide/sync-options/#skip-dry-run-for-new-custom-resources-types">Skip Dry Run for new custom resources types</a> for more information.</p>
</div>
<ul>
<li>
<p>Create a <code>CompositeResourceDefinition</code> file.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &gt; 1_definition.yaml <span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: apiextensions.crossplane.io/v1</span>
<span class="s">kind: CompositeResourceDefinition</span>
<span class="s">metadata:</span>
<span class="s">    name: xdostorages.storage.acw.alvsanand.github.io</span>
<span class="s">    annotations:</span>
<span class="s">        argocd.argoproj.io/sync-wave: &quot;1&quot;</span>
<span class="s">spec:</span>
<span class="s">    group: storage.acw.alvsanand.github.io</span>
<span class="s">    names:</span>
<span class="s">        kind: XDObjectStorage</span>
<span class="s">        plural: xdostorages</span>
<span class="s">    claimNames:</span>
<span class="s">        kind: ObjectStorage</span>
<span class="s">        plural: ostorages</span>
<span class="s">    versions:</span>
<span class="s">        - name: v1alpha1</span>
<span class="s">          served: true</span>
<span class="s">          referenceable: true</span>
<span class="s">          schema:</span>
<span class="s">              openAPIV3Schema:</span>
<span class="s">                  type: object</span>
<span class="s">                  properties:</span>
<span class="s">                      spec:</span>
<span class="s">                          type: object</span>
<span class="s">                          properties:</span>
<span class="s">                              parameters:</span>
<span class="s">                                  type: object</span>
<span class="s">                                  properties:</span>
<span class="s">                                      storageName:</span>
<span class="s">                                          type: string</span>
<span class="s">                                  required:</span>
<span class="s">                                      - storageName</span>
<span class="s">                          required:</span>
<span class="s">                              - parameters</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Create a <code>Composition</code> file.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &gt; 1_composition.yaml <span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: apiextensions.crossplane.io/v1</span>
<span class="s">kind: Composition</span>
<span class="s">metadata:</span>
<span class="s">    name: xdostorages.aws.storage.acw.alvsanand.github.io</span>
<span class="s">    labels:</span>
<span class="s">        serviceType: storage</span>
<span class="s">        provider: aws</span>
<span class="s">    annotations:</span>
<span class="s">        argocd.argoproj.io/sync-wave: &quot;1&quot;</span>
<span class="s">spec:</span>
<span class="s">    compositeTypeRef:</span>
<span class="s">        apiVersion: storage.acw.alvsanand.github.io/v1alpha1</span>
<span class="s">        kind: XDObjectStorage</span>
<span class="s">    resources:</span>
<span class="s">        - name: s3bucket</span>
<span class="s">          base:</span>
<span class="s">              apiVersion: s3.aws.crossplane.io/v1beta1</span>
<span class="s">              kind: Bucket</span>
<span class="s">              spec:</span>
<span class="s">                  forProvider:</span>
<span class="s">                      acl: public-read-write</span>
<span class="s">                      locationConstraint: us-east-1</span>
<span class="s">                  providerConfigRef:</span>
<span class="s">                      name: default</span>
<span class="s">          patches:</span>
<span class="s">              - fromFieldPath: &quot;spec.parameters.storageName&quot;</span>
<span class="s">                toFieldPath: &quot;metadata.name&quot;</span>
<span class="s">                transforms:</span>
<span class="s">                    - type: string</span>
<span class="s">                      string:</span>
<span class="s">                          fmt: &quot;%s-acw&quot;</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Create a <code>Claim</code> file.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &gt; 2_claim.yaml <span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: storage.acw.alvsanand.github.io/v1alpha1</span>
<span class="s">kind: XDObjectStorage</span>
<span class="s">metadata:</span>
<span class="s">    name: some-bucket</span>
<span class="s">    namespace: default</span>
<span class="s">    annotations:</span>
<span class="s">        argocd.argoproj.io/sync-wave: &quot;2&quot;</span>
<span class="s">        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true</span>
<span class="s">spec:</span>
<span class="s">    compositionSelector:</span>
<span class="s">        matchLabels:</span>
<span class="s">            provider: aws</span>
<span class="s">    parameters:</span>
<span class="s">        storageName: some-bucket</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
</li>
</ul>
<h2 id="2-create-an-app-in-argocd">2. Create an App in ArgoCD</h2>
<p>After the repository is created, we should create an <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications">Application</a> in ArgoCD. Therefore, ArgoCD will sync the Crossplane resources will the state stored in the repository. However, having the repository with no files will not create any resources.</p>
<ul>
<li>
<p>Obtain HTTPS url of the GIT repository.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">HTTPS_REPO_URL</span><span class="o">=</span><span class="k">$(</span>git remote show origin <span class="p">|</span>  sed -nr <span class="s1">&#39;s/.+Fetch URL: git@(.+):(.+).git/https:\/\/\1\/\2.git/p&#39;</span><span class="k">)</span>
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Create a new Application in auto mode and listening to the master.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: argoproj.io/v1alpha1</span>
<span class="s">kind: Application</span>
<span class="s">metadata:</span>
<span class="s">  name: acw-storage</span>
<span class="s">  namespace: argocd</span>
<span class="s">spec:</span>
<span class="s">  project: default</span>
<span class="s">  source:</span>
<span class="s">    repoURL: $HTTPS_REPO_URL</span>
<span class="s">    targetRevision: main</span>
<span class="s">    path: .</span>
<span class="s">  destination:</span>
<span class="s">    server: https://kubernetes.default.svc</span>
<span class="s">    namespace: apify-your-infra-with-crossplane</span>
<span class="s">  syncPolicy:</span>
<span class="s">    automated: {}</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Wait until the application is sync.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl get applications -n argocd acw-storage

...    
NAME          SYNC STATUS   HEALTH STATUS
acw-storage   Synced        Healthy
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Furthermore, you can check in <a href="https://localhost:10443/applications/acw-storage?resource=&amp;conditions=false">ArgoCD UI</a> the status of the application.</p>
</li>
</ul>
<p><img alt="ArgoCD - Application Empty" src="../assets/images/argocd-created-app.png" /></p>
<h2 id="3-commit-changes-to-github">3. Commit changes to Github</h2>
<p>After ArgoCD is ready to watch for changes, we will push the files to the repo in order to force the deployment.</p>
<ul>
<li>
<p>Add files and generate a commit.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>git add *.yaml
git commit -m <span class="s2">&quot;Added Crossplane files&quot;</span>
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Push changes to Github.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>git push --set-upstream origin main
</code></pre></div>
</td></tr></table>
</li>
</ul>
<h2 id="4-wait-for-argocd-to-sync">4. Wait for ArgoCD to sync</h2>
<p>Now that the changes are in Git, ArgoCD will detect the chances and sync our infrastructure to match the state of the repository.</p>
<ul>
<li>Wait some minutes until the application is synced.</li>
</ul>
<p><img alt="ArgoCD - Application Syncing" src="../assets/images/argocd-syncing-app.png" /></p>
<ul>
<li>
<p>After the sync is completed, you can check the application status.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl describe applications -n argocd acw-storage

...    
Name:         acw-storage
Namespace:    argocd
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  argoproj.io/v1alpha1
Kind:         Application
Metadata:
  Creation Timestamp:  <span class="m">2022</span>-01-07T12:51:44Z
  Generation:          <span class="m">12</span>
  Managed Fields:
    API Version:  argoproj.io/v1alpha1
    Fields Type:  FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .:
          f:kubectl.kubernetes.io/last-applied-configuration:
      f:spec:
        .:
        f:destination:
          .:
          f:namespace:
          f:server:
        f:project:
        f:source:
          .:
          f:path:
          f:repoURL:
          f:targetRevision:
        f:syncPolicy:
          .:
          f:automated:
    Manager:      kubectl-client-side-apply
    Operation:    Update
    Time:         <span class="m">2022</span>-01-07T12:51:44Z
    API Version:  argoproj.io/v1alpha1
    Fields Type:  FieldsV1
    fieldsV1:
      f:status:
        .:
        f:health:
          .:
          f:status:
        f:history:
        f:operationState:
          .:
          f:finishedAt:
          f:message:
          f:operation:
            .:
            f:initiatedBy:
              .:
              f:automated:
            f:retry:
              .:
              f:limit:
            f:sync:
              .:
              f:revision:
          f:phase:
          f:startedAt:
          f:syncResult:
            .:
            f:resources:
            f:revision:
            f:source:
              .:
              f:path:
              f:repoURL:
              f:targetRevision:
        f:reconciledAt:
        f:resources:
        f:sourceType:
        f:summary:
        f:sync:
          .:
          f:comparedTo:
            .:
            f:destination:
              .:
              f:namespace:
              f:server:
            f:source:
              .:
              f:path:
              f:repoURL:
              f:targetRevision:
          f:revision:
          f:status:
    Manager:         argocd-application-controller
    Operation:       Update
    Time:            <span class="m">2022</span>-01-07T12:51:52Z
  Resource Version:  <span class="m">27693</span>
  UID:               24016e22-b199-4ed4-9f2b-6ce96018f798
Spec:
  Destination:
    Namespace:  apify-your-infra-with-crossplane
    Server:     https://kubernetes.default.svc
  Project:      default
  Source:
    Path:             .
    Repo URL:         https://github.com/alvsanand/acw-crossplane-with-argocd.git
    Target Revision:  main
  Sync Policy:
    Automated:
Status:
  Health:
    Status:  Healthy
  History:
    Deploy Started At:  <span class="m">2022</span>-01-07T12:51:45Z
    Deployed At:        <span class="m">2022</span>-01-07T12:51:52Z
    Id:                 <span class="m">0</span>
    Revision:           2d55ed389750624c21bce8c2d534f4b77d72f837
    Source:
      Path:             .
      Repo URL:         https://github.com/alvsanand/acw-crossplane-with-argocd.git
      Target Revision:  main
  Operation State:
    Finished At:  <span class="m">2022</span>-01-07T12:51:52Z
    Message:      successfully synced <span class="o">(</span>all tasks run<span class="o">)</span>
    Operation:
      Initiated By:
        Automated:  <span class="nb">true</span>
      Retry:
        Limit:  <span class="m">5</span>
      Sync:
        Revision:  2d55ed389750624c21bce8c2d534f4b77d72f837
    Phase:         Succeeded
    Started At:    <span class="m">2022</span>-01-07T12:51:45Z
    Sync Result:
      Resources:
        Group:       apiextensions.crossplane.io
        Hook Phase:  Succeeded
        Kind:        Composition
        Message:     composition.apiextensions.crossplane.io/xdostorages.aws.storage.acw.alvsanand.github.io created
        Name:        xdostorages.aws.storage.acw.alvsanand.github.io
        Namespace:   apify-your-infra-with-crossplane
        Status:      Synced
        Sync Phase:  Sync
        Version:     v1
        Group:       apiextensions.crossplane.io
        Hook Phase:  Succeeded
        Kind:        CompositeResourceDefinition
        Message:     compositeresourcedefinition.apiextensions.crossplane.io/xdostorages.storage.acw.alvsanand.github.io created
        Name:        xdostorages.storage.acw.alvsanand.github.io
        Namespace:   apify-your-infra-with-crossplane
        Status:      Synced
        Sync Phase:  Sync
        Version:     v1
        Group:       storage.acw.alvsanand.github.io
        Hook Phase:  Running
        Kind:        XDObjectStorage
        Message:     xdobjectstorage.storage.acw.alvsanand.github.io/some-bucket created
        Name:        some-bucket
        Namespace:   apify-your-infra-with-crossplane
        Status:      Synced
        Sync Phase:  Sync
        Version:     v1alpha1
      Revision:      2d55ed389750624c21bce8c2d534f4b77d72f837
      Source:
        Path:             .
        Repo URL:         https://github.com/alvsanand/acw-crossplane-with-argocd.git
        Target Revision:  main
  Reconciled At:          <span class="m">2022</span>-01-07T12:51:52Z
  Resources:
    Group:      apiextensions.crossplane.io
    Kind:       CompositeResourceDefinition
    Name:       xdostorages.storage.acw.alvsanand.github.io
    Status:     Synced
    Version:    v1
    Group:      apiextensions.crossplane.io
    Kind:       Composition
    Name:       xdostorages.aws.storage.acw.alvsanand.github.io
    Status:     Synced
    Version:    v1
    Group:      storage.acw.alvsanand.github.io
    Kind:       XDObjectStorage
    Name:       some-bucket
    Status:     Synced
    Version:    v1alpha1
  Source Type:  Directory
  Summary:
  Sync:
    Compared To:
      Destination:
        Namespace:  apify-your-infra-with-crossplane
        Server:     https://kubernetes.default.svc
      Source:
        Path:             .
        Repo URL:         https://github.com/alvsanand/acw-crossplane-with-argocd.git
        Target Revision:  main
    Revision:             2d55ed389750624c21bce8c2d534f4b77d72f837
    Status:               Synced
Events:
  Type    Reason              Age    From                           Message
  ----    ------              ----   ----                           -------
  Normal  OperationStarted    4m34s  argocd-application-controller  Initiated automated sync to <span class="s1">&#39;2d55ed389750624c21bce8c2d534f4b77d72f837&#39;</span>
  Normal  ResourceUpdated     4m34s  argocd-application-controller  Updated sync status:  -&gt; OutOfSync
  Normal  ResourceUpdated     4m34s  argocd-application-controller  Updated health status:  -&gt; Healthy
  Normal  ResourceUpdated     4m33s  argocd-application-controller  Updated sync status:  -&gt; OutOfSync
  Normal  ResourceUpdated     4m33s  argocd-application-controller  Updated health status:  -&gt; Healthy
  Normal  OperationCompleted  4m27s  argocd-application-controller  Sync operation to 2d55ed389750624c21bce8c2d534f4b77d72f837 succeeded
  Normal  ResourceUpdated     4m27s  argocd-application-controller  Updated sync status: OutOfSync -&gt; Synced
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Finally, you can check in <a href="https://localhost:10443/applications/acw-storage?resource=&amp;conditions=false">ArgoCD UI</a> the status of the application.</p>
</li>
</ul>
<p><img alt="ArgoCD - Application Synced" src="../assets/images/argocd-synced-app.png" /></p>
<ul>
<li>
<p>Check that the xdostorages is created.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl get xdostorages

...
NAME          READY   COMPOSITION                                       AGE
some-bucket   True    xdostorages.aws.storage.acw.alvsanand.github.io   89s
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Check that the bucket object is created.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl get bucket

...
NAME              READY   SYNCED   AGE
some-bucket-acw   True    True     113s
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Check that the bucket has been created in LocalStack.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>awslocal s3api list-buckets

...
<span class="o">{</span>
    <span class="s2">&quot;Buckets&quot;</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;some-bucket-acw&quot;</span>,
            <span class="s2">&quot;CreationDate&quot;</span>: <span class="s2">&quot;2022-01-06T08:05:16.000Z&quot;</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">&quot;Owner&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;DisplayName&quot;</span>: <span class="s2">&quot;webfile&quot;</span>,
        <span class="s2">&quot;ID&quot;</span>: <span class="s2">&quot;bcaf1ffd86f41161ca5fb16fd081034f&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</td></tr></table>
</li>
</ul>
<h2 id="5-cleanup-the-laboratory">5. Cleanup the laboratory</h2>
<p>Last step, delete all resources created. In this case, we should delete the application and ArgoCD will delete the resources created with it.</p>
<ul>
<li>
<p>Delete the application.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl delete application -n argocd acw-storage
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Check that the bucket has been created in LocalStack.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>awslocal s3api list-buckets

...
<span class="o">{</span>
    <span class="s2">&quot;Buckets&quot;</span>: <span class="o">[]</span>,
    <span class="s2">&quot;Owner&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;DisplayName&quot;</span>: <span class="s2">&quot;webfile&quot;</span>,
        <span class="s2">&quot;ID&quot;</span>: <span class="s2">&quot;bcaf1ffd86f41161ca5fb16fd081034f&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</td></tr></table>
</li>
</ul>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../know-the-basis/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 2 - Know the basis" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lab 2 - Know the basis
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
      
    
  </body>
</html>